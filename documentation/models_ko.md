# 모델 아키텍처 (`models.py`)

이 프로젝트는 Li 등(2021)이 제안한 **자기 조직화 그래프 신경망(Self-Organized Graph Neural Network, SOGNN)**을 전극 절제 연구에 맞게 조정하여 사용합니다.

## SOGC: 자기 조직화 그래프 합성곱 (Self-Organized Graph Convolution)

SOGNN의 핵심은 SOGC 레이어로, 고정된 거리 기반 인접 행렬을 사용하는 대신 모든 입력 샘플에 대해 동적인 그래프 구조를 학습합니다.

### 인접 행렬 학습 메커니즘
1. **병목 투영 (Bottleneck Projection)**: 선형 레이어와 `tanh` 활성화 함수를 사용하여 노드 특징을 저차원 공간으로 투영합니다.
2. **유사도 계산**: 배치 행렬 곱셈을 통해 유사도 행렬을 계산합니다: $A = \text{softmax}(G \cdot G^T)$.
3. **Top-k 희소화 (Sparsification)**: 각 전극에 대해 가장 유의미한 $k$개의 연결(기본값 $k=10$)만 남깁니다. 이를 통해 그래프를 희소하게 유지하고 가장 관련성이 높은 전극 간 관계에 집중합니다.
4. **셀프 루프 (Self-Loops)**: 대각 성분을 1.0으로 설정하여 메시지 패싱 과정에서 노드가 자신의 특징 정보를 유지하도록 합니다.

### 그래프 합성곱 (Graph Convolution)
합성곱은 표준 공식을 따릅니다: $H' = \text{ReLU}(A \cdot H \cdot W)$, 여기서 $A$는 학습된 희소 인접 행렬이고 $W$는 가중치 행렬입니다.

## SOGNN: 시스템 통합

SOGNN 모델은 2D CNN 백본과 여러 SOGC 분기를 결합하여 다중 스케일의 공간적 및 시간적 특징을 포착합니다.

### 1. 전극별 CNN 처리
그래프 연산 전에 각 전극의 $(Bands \times Time)$ 맵은 일련의 합성곱 및 맥스 풀링 레이어에 의해 독립적으로 처리됩니다. 이는 초기 단계에서 전극 간의 특징 혼합을 방지하고 모델이 깨끗한 스펙트럼-시간적 특징을 추출할 수 있게 합니다.

### 2. 다중 스케일 병렬 분기
SOGNN은 CNN 백본의 서로 다른 깊이에서 특징을 가져오는 세 개의 병렬 분기를 사용합니다:
- **분기 1**: 저수준 특징 (`conv1`에서 추출)
- **분기 2**: 중간 수준 특징 (`conv2`에서 추출)
- **분기 3**: 고수준 특징 (`conv3`에서 추출)

각 분기는 전용 SOGC 레이어를 거치며, 이를 통해 모델은 다양한 추상화 수준에서 전극 간의 관계를 추론할 수 있습니다.

### 3. 특징 융합
세 분기의 SOGC 출력은 모두 연결(concatenate)되고 평탄화(flatten)됩니다. 이 결과는 최종 선형 분류기를 거쳐 4개의 감정 로짓(logits)을 생성합니다.

## 절제 실험을 위한 설계

모델은 **전극 수에 구애받지 않도록(electrode-count agnostic)** 설계되었습니다:
- **동적 차원 결정**: 초기화 중에 더미 포워드 패스를 사용하여 평탄화 차원을 계산하므로, 임의의 전극 수(예: 바닥부터 재훈련하는 절제 실험 시)로 모델을 생성할 수 있습니다.
- **마스킹 호환성**: 포워드 패스는 4D 텐서를 수용하므로, 나머지 채널에 대한 그래프 구성 로직을 변경하지 않고도 특정 채널에 이진 마스크를 적용할 수 있습니다.
